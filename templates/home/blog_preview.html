<!-- åšå®¢é¢„è§ˆåŒºåŸŸ -->
<section id="blog-preview" class="py-20 px-4 md:px-8 bg-apple-lightgray">
    <div class="container mx-auto max-w-4xl">
        <h2 class="text-3xl md:text-4xl font-bold mb-16 text-center reveal-element">{{ title }}</h2>

        <!-- æ¿å—é€‰é¡¹å¡ -->
        <div class="flex flex-wrap justify-center gap-4 reveal-element" data-sr-delay="200">
            {% for category in categories %}
            <button onclick="switchBlogCategory('{{ category.id }}')"
                    id="blog-tab-{{ category.id }}"
                    class="blog-category-tab px-6 py-3 rounded-full bg-white border-2 border-gray-200 hover:border-apple-hover hover:bg-apple-hover hover:text-white transition-all {{ 'bg-apple-hover text-white border-apple-hover active' if loop.first else '' }}">
                <i class="fa-solid {{ category.icon }} mr-2"></i>
                {{ category.name }}
            </button>
            {% endfor %}
        </div>

        <!-- ä»£è¡¨æ€§æ–‡ç« å¡ç‰‡åŒºåŸŸ -->
        <div id="featured-cards-container" class="mt-12">
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
                {% for card in featured_cards %}
                {% set card_delay = loop.index * 200 %}
                {% include 'components/card.html' %}
                {% endfor %}
            </div>
        </div>

        <!-- æ¿å—æè¿°åŒºåŸŸ -->
        <div class="text-center mt-8 reveal-element" data-sr-delay="300">
            <div id="blog-category-description" class="bg-white rounded-xl p-6 max-w-2xl mx-auto shadow-sm">
                <p class="text-apple-gray italic">é€‰æ‹©ä¸Šæ–¹æ¿å—æ ‡ç­¾ï¼Œæµè§ˆä¸åŒä¸»é¢˜çš„æ–‡ç« å†…å®¹</p>
            </div>
        </div>
    </div>
</section>

<!-- JavaScript for blog category switching -->
<script>
let currentBlogCategory = '';

function switchBlogCategory(categoryId) {
    currentBlogCategory = categoryId;

    // æ›´æ–°é€‰é¡¹å¡æ ·å¼
    document.querySelectorAll('.blog-category-tab').forEach(tab => {
        tab.classList.remove('bg-apple-hover', 'text-white', 'border-apple-hover', 'active');
        tab.classList.add('bg-white', 'border-gray-200');
    });

    // é«˜äº®å½“å‰é€‰é¡¹å¡
    const activeTab = document.getElementById(`blog-tab-${categoryId}`);
    if (activeTab) {
        activeTab.classList.remove('bg-white', 'border-gray-200');
        activeTab.classList.add('bg-apple-hover', 'text-white', 'border-apple-hover', 'active');
    }

    // æ›´æ–°å¡ç‰‡åŒºåŸŸå’Œæè¿°åŒºåŸŸ
    updateCategoryContent(categoryId);

    console.log('åˆ‡æ¢åˆ°åšå®¢æ¿å—:', categoryId);
}

function updateCategoryContent(categoryId) {
    const category = blogCategories.find(c => c.id === categoryId);
    const descriptionDiv = document.getElementById('blog-category-description');
    const cardsContainer = document.getElementById('featured-cards-container');

    if (descriptionDiv && category) {
        // æŠ€æœ¯åˆ†äº«åˆ†ç±»æ˜¾ç¤ºå¡ç‰‡ï¼Œå…¶ä»–åˆ†ç±»æ˜¾ç¤ºæç¤º
        if (categoryId === 'æŠ€æœ¯åˆ†äº«') {
            descriptionDiv.innerHTML = `
                <h3 class="text-lg font-semibold mb-2">${category.name}</h3>
                <p class="text-gray-600">${category.description}</p>
                <div class="mt-4">
                    <span class="text-sm text-green-600">ğŸ“š æŸ¥çœ‹ä¸‹æ–¹ç²¾é€‰æ–‡ç« </span>
                </div>
            `;
            // æ˜¾ç¤ºå¡ç‰‡å®¹å™¨
            if (cardsContainer) {
                cardsContainer.style.display = 'block';
            }
        } else {
            descriptionDiv.innerHTML = `
                <h3 class="text-lg font-semibold mb-2">${category.name}</h3>
                <p class="text-gray-600">${category.description}</p>
                <div class="mt-4">
                    <span class="text-sm text-gray-500">è¯¥æ¿å—çš„åšå®¢æ–‡ç« æ­£åœ¨å‡†å¤‡ä¸­ï¼Œæ•¬è¯·æœŸå¾…ï¼</span>
                </div>
            `;
            // éšè—å¡ç‰‡å®¹å™¨
            if (cardsContainer) {
                cardsContainer.style.display = 'none';
            }
        }
    }
}

// å…¨å±€å˜é‡å­˜å‚¨åˆ†ç±»æ•°æ®
const blogCategories = JSON.parse('{{ categories|tojson|safe }}');

// åˆå§‹åŒ–
document.addEventListener('DOMContentLoaded', function() {
    // é»˜è®¤é€‰ä¸­ç¬¬ä¸€ä¸ªæ¿å—
    const firstCategory = blogCategories[0];
    if (firstCategory) {
        switchBlogCategory(firstCategory.id);
    }
});
</script>
